---
title: "plvs-fft-with-groups"
output: html_notebook
---
```{r}
library(lme4)
library(lmerTest)
library(emmeans)
library(performance) # for conditional and marginal R^2 for overall model
library(r2glmm) # for semi-partial R^2 for each predictor
```


```{r}
(df <- read.csv('~/Documents/Work/dissertation/Cognition-FFR-passive-2025/analysis/plvs-with-groups.csv'))
```

```{r}
df$passive <- as.factor(df$passive)
df$stim_freq <- as.factor(df$stim_freq)
df$passive_order <- as.factor(df$passive_order)
df$group <- as.factor(df$group)
```

```{r}
model <- lmer(plv ~ passive * stim_freq * passive_order * group + (1 | sub), data = df)
summary(model)
```

```{r}
# Conditional and Marginal R^2 for variance explained by fixed effects and random effects, and fixed effects alone
r2_nakagawa(model)

# Semi-partial R² (R²β)* for individual predictors
r2beta(model, method = "nsj", partial = TRUE)
```

```{r}
# Post-hoc comparisons
print("----------- tone -----------")
emm <- emmeans(model, ~ stim_freq, adjust = 'tukey')
print(emm)
pairs(emm)
d_emm <- eff_size(emm, sigma = sigma(model), edf = df.residual(model))
print(d_emm)
print("----------- tone * condition order -----------")
emm <- emmeans(model, ~ stim_freq * passive_order, adjust = 'tukey')
print(emm)
pairs(emm)
d_emm <- eff_size(emm, sigma = sigma(model), edf = df.residual(model))
print(d_emm)
```

